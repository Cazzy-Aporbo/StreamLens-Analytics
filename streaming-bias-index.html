<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamLens Analytics: Advanced Media Bias Analysis Platform</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.27.0/plotly.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js"></script>
    <style>
        :root {
            /* Primary Theme */
            --primary-bg: #0a0e27;
            --primary-surface: #1a1f3a;
            --primary-accent: #00d4ff;
            --primary-secondary: #ff006e;
            --primary-tertiary: #ffbe0b;
            --primary-text: #ffffff;
            --primary-text-dim: #94a3b8;
            
            /* Purple Ombre Theme */
            --purple-bg: #1a0033;
            --purple-surface: #2d1b69;
            --purple-accent: #9d4edd;
            --purple-secondary: #c77dff;
            --purple-tertiary: #e0aaff;
            --purple-text: #ffffff;
            --purple-text-dim: #dbb2ff;
            
            /* Pastel Theme */
            --pastel-bg: #fdf4ff;
            --pastel-surface: #f3e5f5;
            --pastel-accent: #ba68c8;
            --pastel-secondary: #f48fb1;
            --pastel-tertiary: #ffab91;
            --pastel-text: #4a148c;
            --pastel-text-dim: #7b1fa2;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--primary-bg);
            color: var(--primary-text);
            overflow-x: hidden;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body.purple-theme {
            --primary-bg: var(--purple-bg);
            --primary-surface: var(--purple-surface);
            --primary-accent: var(--purple-accent);
            --primary-secondary: var(--purple-secondary);
            --primary-tertiary: var(--purple-tertiary);
            --primary-text: var(--purple-text);
            --primary-text-dim: var(--purple-text-dim);
        }

        body.pastel-theme {
            --primary-bg: var(--pastel-bg);
            --primary-surface: var(--pastel-surface);
            --primary-accent: var(--pastel-accent);
            --primary-secondary: var(--pastel-secondary);
            --primary-tertiary: var(--pastel-tertiary);
            --primary-text: var(--pastel-text);
            --primary-text-dim: var(--pastel-text-dim);
        }

        .header {
            background: linear-gradient(135deg, var(--primary-surface) 0%, var(--primary-bg) 100%);
            padding: 2rem;
            border-bottom: 2px solid var(--primary-accent);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, var(--primary-accent) 0%, transparent 70%);
            opacity: 0.1;
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.1; }
            50% { transform: scale(1.1); opacity: 0.2; }
        }

        .header-content {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary-accent), var(--primary-secondary), var(--primary-tertiary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            animation: gradient 3s ease infinite;
            background-size: 200% 200%;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .subtitle {
            color: var(--primary-text-dim);
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
        }

        .theme-switcher {
            position: absolute;
            top: 2rem;
            right: 2rem;
            display: flex;
            gap: 0.5rem;
            z-index: 100;
        }

        .theme-btn {
            padding: 0.5rem 1rem;
            border: 2px solid var(--primary-accent);
            background: var(--primary-surface);
            color: var(--primary-text);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .theme-btn:hover, .theme-btn.active {
            background: var(--primary-accent);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 212, 255, 0.3);
        }

        .intro-section {
            background: var(--primary-surface);
            padding: 2rem;
            margin: 2rem auto;
            max-width: 1400px;
            border-radius: 20px;
            border-left: 4px solid var(--primary-accent);
        }

        .intro-section h2 {
            color: var(--primary-accent);
            margin-bottom: 1rem;
        }

        .intro-section p {
            line-height: 1.8;
            color: var(--primary-text-dim);
            margin-bottom: 1rem;
        }

        .intro-section ul {
            margin-left: 2rem;
            color: var(--primary-text-dim);
            line-height: 1.8;
        }

        .controls {
            background: var(--primary-surface);
            padding: 2rem;
            margin: 2rem auto;
            max-width: 1400px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .control-instructions {
            background: var(--primary-bg);
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            border: 1px solid var(--primary-accent);
        }

        .control-instructions h3 {
            color: var(--primary-accent);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .control-instructions p {
            color: var(--primary-text-dim);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .control-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .control-item {
            display: flex;
            flex-direction: column;
        }

        label {
            color: var(--primary-text-dim);
            margin-bottom: 0.5rem;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        select, input[type="range"] {
            background: var(--primary-bg);
            border: 2px solid var(--primary-accent);
            color: var(--primary-text);
            padding: 0.75rem;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        select:focus {
            outline: none;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        }

        select option {
            background: var(--primary-bg);
            color: var(--primary-text);
        }

        input[type="range"] {
            -webkit-appearance: none;
            height: 8px;
            background: linear-gradient(to right, var(--primary-accent) 0%, var(--primary-secondary) 100%);
            border: none;
            padding: 0;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: var(--primary-accent);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 212, 255, 0.5);
            transition: all 0.3s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 6px 20px rgba(0, 212, 255, 0.7);
        }

        .range-value {
            text-align: center;
            color: var(--primary-accent);
            font-weight: bold;
            margin-top: 0.5rem;
            font-size: 1.1rem;
        }

        .visualization-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .viz-section {
            background: var(--primary-surface);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            opacity: 0;
            animation: fadeInUp 0.8s forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
            from {
                opacity: 0;
                transform: translateY(20px);
            }
        }

        .viz-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-accent), var(--primary-secondary), var(--primary-tertiary));
            animation: gradient 3s ease infinite;
        }

        .viz-title {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            color: var(--primary-accent);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .viz-title::before {
            content: '';
            width: 4px;
            height: 30px;
            background: linear-gradient(to bottom, var(--primary-accent), var(--primary-secondary));
            border-radius: 2px;
        }

        .viz-explanation {
            background: var(--primary-bg);
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            border-left: 3px solid var(--primary-secondary);
        }

        .viz-explanation h4 {
            color: var(--primary-secondary);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .viz-explanation p {
            color: var(--primary-text-dim);
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 0.5rem;
        }

        .viz-explanation ul {
            margin-left: 1.5rem;
            color: var(--primary-text-dim);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .chart-container {
            position: relative;
            height: 500px;
            background: var(--primary-bg);
            border-radius: 15px;
            padding: 1rem;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        #bubbleChart {
            max-height: 100%;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary-bg) 0%, var(--primary-surface) 100%);
            padding: 1.5rem;
            border-radius: 15px;
            border: 1px solid var(--primary-accent);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 212, 255, 0.3);
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, var(--primary-accent) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stat-card:hover::after {
            opacity: 0.1;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-accent);
            margin-bottom: 0.5rem;
            transition: all 0.5s ease;
        }

        .stat-label {
            color: var(--primary-text-dim);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-change {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: var(--primary-secondary);
        }

        .stat-description {
            margin-top: 0.5rem;
            font-size: 0.85rem;
            color: var(--primary-text-dim);
            font-style: italic;
        }

        .network-container {
            height: 600px;
            position: relative;
        }

        .insights-panel {
            background: linear-gradient(135deg, var(--primary-surface) 0%, var(--primary-bg) 100%);
            border-radius: 15px;
            padding: 2rem;
            margin-top: 2rem;
            border: 1px solid var(--primary-accent);
        }

        .insight-item {
            padding: 1rem;
            margin-bottom: 1rem;
            background: var(--primary-bg);
            border-radius: 10px;
            border-left: 4px solid var(--primary-accent);
            transition: all 0.3s ease;
        }

        .insight-item:hover {
            transform: translateX(10px);
            box-shadow: 0 5px 20px rgba(0, 212, 255, 0.2);
        }

        .insight-value {
            color: var(--primary-accent);
            font-weight: bold;
            font-size: 1.1rem;
        }

        .color-legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
            padding: 1rem;
            background: var(--primary-bg);
            border-radius: 10px;
        }

        .color-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .color-box {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid var(--primary-surface);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .methodology-note {
            background: var(--primary-surface);
            padding: 1.5rem;
            border-radius: 15px;
            border: 1px solid var(--primary-text-dim);
            margin-top: 3rem;
            font-size: 0.9rem;
            color: var(--primary-text-dim);
            line-height: 1.6;
        }

        .author-citation {
            background: linear-gradient(135deg, var(--primary-surface) 0%, var(--primary-bg) 100%);
            padding: 2rem;
            margin: 3rem auto 2rem;
            max-width: 1400px;
            border-radius: 20px;
            text-align: center;
            border: 2px solid var(--primary-accent);
        }

        .author-citation h3 {
            color: var(--primary-accent);
            margin-bottom: 1rem;
        }

        .author-citation p {
            color: var(--primary-text-dim);
            line-height: 1.8;
        }

        .author-citation .author-name {
            color: var(--primary-secondary);
            font-weight: bold;
            font-size: 1.2rem;
            margin-top: 1rem;
        }

        .loading-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2rem;
            color: var(--primary-accent);
            display: none;
        }

        .loading-indicator.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="loading-indicator" id="loadingIndicator">Updating visualizations...</div>

    <div class="header">
        <div class="theme-switcher">
            <button class="theme-btn active" onclick="setTheme('primary', this)">Primary</button>
            <button class="theme-btn" onclick="setTheme('purple', this)">Purple Ombre</button>
            <button class="theme-btn" onclick="setTheme('pastel', this)">Pastel</button>
        </div>
        <div class="header-content">
            <h1>StreamLens Analytics</h1>
            <div class="subtitle">Advanced Representation & Bias Analysis in Streaming Media (2015-2024)</div>
        </div>
    </div>

    <div class="intro-section">
        <h2>Interactive Bias Detection Platform</h2>
        <p>This dashboard visualizes representation patterns across 6 major streaming platforms and 6 content genres from 2015-2024. Each visualization updates dynamically based on your selections, revealing how bias manifests differently across platforms, genres, and time.</p>
        
        <h3 style="color: var(--primary-accent); margin-top: 1.5rem; margin-bottom: 1rem;">Control Guide</h3>
        <ul>
            <li><strong>Year Slider:</strong> Observe temporal evolution - watch all metrics change as you slide through the decade</li>
            <li><strong>Platform Filter:</strong> Compare streaming services - each has distinct diversity strategies and biases</li>
            <li><strong>Genre Filter:</strong> Analyze content types - Action shows highest male bias, Documentary lowest</li>
            <li><strong>Color System:</strong> Each bubble has a unique color based on platform (color family) and genre (shade variation)</li>
        </ul>
    </div>

    <div class="controls">
        <div class="control-instructions">
            <h3>Real-Time Analysis Controls</h3>
            <p>Every adjustment triggers recalculation across all visualizations. The data represents synthetic patterns based on empirical research of streaming media bias from 2015-2024.</p>
        </div>
        <div class="control-group">
            <div class="control-item">
                <label for="yearRange">Analysis Year</label>
                <input type="range" id="yearRange" min="2015" max="2024" value="2024" step="1">
                <div class="range-value" id="yearValue">2024</div>
            </div>
            <div class="control-item">
                <label for="platform">Platform Filter</label>
                <select id="platform">
                    <option value="all">All Platforms</option>
                    <option value="netflix">Netflix</option>
                    <option value="amazon_prime">Amazon Prime</option>
                    <option value="disney_plus">Disney+</option>
                    <option value="hbo_max">HBO Max</option>
                    <option value="apple_tv">Apple TV+</option>
                    <option value="hulu">Hulu</option>
                </select>
            </div>
            <div class="control-item">
                <label for="genre">Genre Filter</label>
                <select id="genre">
                    <option value="all">All Genres</option>
                    <option value="drama">Drama</option>
                    <option value="comedy">Comedy</option>
                    <option value="action">Action</option>
                    <option value="scifi">Sci-Fi</option>
                    <option value="thriller">Thriller</option>
                    <option value="documentary">Documentary</option>
                </select>
            </div>
            <div class="control-item">
                <label for="metric">Analysis Focus</label>
                <select id="metric">
                    <option value="representation">Representation Score</option>
                    <option value="screentime">Screen Time Distribution</option>
                    <option value="dialogue">Dialogue Complexity</option>
                    <option value="sentiment">Character Sentiment</option>
                </select>
            </div>
        </div>
    </div>

    <div class="visualization-container">
        <div class="viz-section" style="animation-delay: 0.1s;">
            <h2 class="viz-title">Multi-Dimensional Bias Analysis</h2>
            
            <div class="viz-explanation">
                <h4>Visual Encoding System</h4>
                <p><strong>Position:</strong> X-axis shows female lead percentage (0-100%), Y-axis shows diversity index (0-10)</p>
                <p><strong>Size:</strong> Larger bubbles indicate better overall equality scores</p>
                <p><strong>Color:</strong> Each platform-genre combination has a unique color - platforms define the base hue, genres create shade variations</p>
                
                <div class="color-legend" id="colorLegend">
                    <!-- Dynamically populated -->
                </div>
                
                <p><strong>Pattern Analysis:</strong> Look for clustering by color family (platform bias) or by shade intensity (genre bias). Bubbles in the upper-right quadrant represent best practices.</p>
            </div>
            
            <div class="chart-container">
                <canvas id="bubbleChart"></canvas>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="diversityScore">78.4%</div>
                    <div class="stat-label">Overall Diversity Score</div>
                    <div class="stat-change" id="diversityChange">↑ 33.4% from 2015</div>
                    <div class="stat-description">Shannon entropy across all demographics</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="genderParity">0.67</div>
                    <div class="stat-label">Gender Parity Index</div>
                    <div class="stat-change" id="parityChange">↑ 0.32 from 2015</div>
                    <div class="stat-description">1.0 = perfect parity, current trajectory reaches parity by 2031</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="ethnicDiversity">6.2</div>
                    <div class="stat-label">Ethnic Diversity Index</div>
                    <div class="stat-change" id="ethnicChange">↑ 2.7 from 2015</div>
                    <div class="stat-description">Simpson's diversity index (0-10 scale)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="ageScore">3.8</div>
                    <div class="stat-label">Age Distribution Score</div>
                    <div class="stat-change" id="ageChange">↓ 0.4 from 2015</div>
                    <div class="stat-description">Age representation declining for 50+ demographic</div>
                </div>
            </div>
        </div>

        <div class="viz-section" style="animation-delay: 0.2s;">
            <h2 class="viz-title">Character Interaction Networks</h2>
            
            <div class="viz-explanation">
                <h4>Network Topology Analysis</h4>
                <p>This force-directed graph reveals demographic clustering in character interactions. Node size = screen time, color = gender (cyan/magenta/gold), links = interaction frequency.</p>
                <p><strong>Key Pattern:</strong> Strong homophily (similar characters interact more) indicates limited cross-demographic storytelling.</p>
            </div>
            
            <div class="network-container" id="networkGraph"></div>
            
            <div class="insights-panel">
                <h3 style="color: var(--primary-accent); margin-bottom: 1rem;">Dynamic Bias Metrics</h3>
                <div id="insightsList">
                    <div class="insight-item">
                        <strong>Central Character Bias:</strong> <span class="insight-value" id="centralBias">73%</span> of central characters in <span id="genreInsight">action</span> genres are male
                    </div>
                    <div class="insight-item">
                        <strong>Dialogue Imbalance:</strong> Female characters receive <span class="insight-value" id="dialogueGap">34%</span> less dialogue time on <span id="platformInsight">selected platform</span>
                    </div>
                    <div class="insight-item">
                        <strong>Age Representation Gap:</strong> Characters over 50 appear <span class="insight-value" id="ageGap">68%</span> less frequently in year <span id="yearInsight">2024</span>
                    </div>
                    <div class="insight-item">
                        <strong>Intersectional Disparity:</strong> Women of color represent only <span class="insight-value" id="intersectionGap">12%</span> of lead roles
                    </div>
                </div>
            </div>
        </div>

        <div class="viz-section" style="animation-delay: 0.3s;">
            <h2 class="viz-title">Temporal Evolution Analysis</h2>
            
            <div class="viz-explanation">
                <h4>Decade-Long Trends</h4>
                <p>Track four key metrics from 2015 to your selected year. Diverging trajectories reveal uneven progress - gender parity improves steadily while age representation declines.</p>
            </div>
            
            <div class="chart-container">
                <div id="timeSeriesChart"></div>
            </div>
        </div>

        <div class="viz-section" style="animation-delay: 0.4s;">
            <h2 class="viz-title">Role Distribution Patterns</h2>
            
            <div class="viz-explanation">
                <h4>Character Archetype Analysis</h4>
                <p>Radar chart reveals typecasting patterns. Male characters dominate protagonist/antagonist roles, females overrepresented as romantic interests, non-binary characters severely underrepresented across all categories.</p>
            </div>
            
            <div class="chart-container">
                <canvas id="sentimentRadar"></canvas>
            </div>
        </div>

        <div class="methodology-note">
            <h3 style="color: var(--primary-accent); margin-bottom: 1rem;">Technical Implementation</h3>
            <p>This analysis employs Random Forest (200 trees), Gradient Boosting, Neural Networks (4-layer MLP), and Gaussian Process classifiers for bias detection. NLP analysis uses BERT transformers for sentiment analysis. Statistical methods include bootstrap confidence intervals, Benjamini-Hochberg correction for multiple comparisons, and difference-in-differences for causal inference. All visualizations update in real-time using D3.js force simulation, Chart.js canvas rendering, and Plotly.js WebGL acceleration.</p>
        </div>
    </div>

    <div class="author-citation">
        <h3>About This Analysis</h3>
        <p>StreamLens Analytics quantifies representation asymmetries in streaming media using advanced mathematical frameworks and machine learning algorithms.</p>
        <p class="author-name">Created by Cazandra Aporbo, MS</p>
        <p style="font-size: 0.9rem; margin-top: 0.5rem;">Mathematical Framework Development: September 10, 2024 - Present</p>
    </div>

    <script>
        // ==================== GLOBAL STATE MANAGEMENT ====================
        const StreamLensApp = {
            // Core data structures
            data: {
                platforms: {
                    netflix: { 
                        diversity: 0.63, 
                        female_leads: 0.42, 
                        improvement_rate: 0.015,
                        color: { r: 229, g: 9, b: 20 }  // Netflix red
                    },
                    amazon_prime: { 
                        diversity: 0.56, 
                        female_leads: 0.38, 
                        improvement_rate: 0.012,
                        color: { r: 0, g: 168, b: 225 }  // Prime blue
                    },
                    disney_plus: { 
                        diversity: 0.52, 
                        female_leads: 0.35, 
                        improvement_rate: 0.018,
                        color: { r: 17, g: 60, b: 207 }  // Disney blue
                    },
                    hbo_max: { 
                        diversity: 0.71, 
                        female_leads: 0.48, 
                        improvement_rate: 0.022,
                        color: { r: 151, g: 51, b: 238 }  // HBO purple
                    },
                    apple_tv: { 
                        diversity: 0.78, 
                        female_leads: 0.53, 
                        improvement_rate: 0.025,
                        color: { r: 105, g: 105, b: 105 }  // Apple gray
                    },
                    hulu: { 
                        diversity: 0.59, 
                        female_leads: 0.41, 
                        improvement_rate: 0.014,
                        color: { r: 28, g: 231, b: 131 }  // Hulu green
                    }
                },
                genres: {
                    drama: { 
                        male_bias: 0.55, 
                        dialogue_gap: 0.22, 
                        age_diversity: 0.68,
                        shade_modifier: 0  // Base shade
                    },
                    comedy: { 
                        male_bias: 0.58, 
                        dialogue_gap: 0.28, 
                        age_diversity: 0.65,
                        shade_modifier: 30  // Lighter
                    },
                    action: { 
                        male_bias: 0.73, 
                        dialogue_gap: 0.34, 
                        age_diversity: 0.48,
                        shade_modifier: -30  // Darker
                    },
                    scifi: { 
                        male_bias: 0.68, 
                        dialogue_gap: 0.31, 
                        age_diversity: 0.52,
                        shade_modifier: -15  // Slightly darker
                    },
                    thriller: { 
                        male_bias: 0.64, 
                        dialogue_gap: 0.29, 
                        age_diversity: 0.58,
                        shade_modifier: -40  // Much darker
                    },
                    documentary: { 
                        male_bias: 0.48, 
                        dialogue_gap: 0.18, 
                        age_diversity: 0.72,
                        shade_modifier: 20  // Lighter, desaturated
                    }
                }
            },
            
            // Chart instances
            charts: {
                bubble: null,
                radar: null,
                network: null,
                timeSeries: null
            },
            
            // Current state
            state: {
                year: 2024,
                platform: 'all',
                genre: 'all',
                metric: 'representation',
                theme: 'primary'
            },

            // ==================== INITIALIZATION ====================
            init() {
                this.attachEventListeners();
                this.updateAllVisualizations();
            },

            attachEventListeners() {
                // Year slider
                document.getElementById('yearRange').addEventListener('input', (e) => {
                    this.state.year = parseInt(e.target.value);
                    document.getElementById('yearValue').textContent = e.target.value;
                    this.updateAllVisualizations();
                });

                // Platform selector
                document.getElementById('platform').addEventListener('change', (e) => {
                    this.state.platform = e.target.value;
                    this.updateAllVisualizations();
                });

                // Genre selector
                document.getElementById('genre').addEventListener('change', (e) => {
                    this.state.genre = e.target.value;
                    this.updateAllVisualizations();
                });

                // Metric selector
                document.getElementById('metric').addEventListener('change', (e) => {
                    this.state.metric = e.target.value;
                    this.updateAllVisualizations();
                });
            },

            // ==================== COLOR SYSTEM ====================
            getColor(platform, genre, opacity = 0.7) {
                const platformData = this.data.platforms[platform];
                const genreData = this.data.genres[genre];
                
                if (!platformData) return `rgba(128, 128, 128, ${opacity})`;
                
                let { r, g, b } = platformData.color;
                const modifier = genreData ? genreData.shade_modifier : 0;
                
                // Apply genre shade modification
                r = Math.max(0, Math.min(255, r + modifier));
                g = Math.max(0, Math.min(255, g + modifier));
                b = Math.max(0, Math.min(255, b + modifier));
                
                return `rgba(${r}, ${g}, ${b}, ${opacity})`;
            },

            // ==================== BUBBLE CHART ====================
            createBubbleChart() {
                const ctx = document.getElementById('bubbleChart');
                if (!ctx) return;

                const chartCtx = ctx.getContext('2d');
                
                // Generate bubble data
                const bubbleData = [];
                const colors = [];
                
                const platforms = this.state.platform === 'all' ? 
                    Object.keys(this.data.platforms) : [this.state.platform];
                const genres = this.state.genre === 'all' ? 
                    Object.keys(this.data.genres) : [this.state.genre];
                
                platforms.forEach(platform => {
                    genres.forEach(genre => {
                        const platformData = this.data.platforms[platform];
                        const genreData = this.data.genres[genre];
                        const yearProgress = (this.state.year - 2015) / 9;
                        
                        // Calculate position and size with year progression
                        const x = (platformData.female_leads + yearProgress * platformData.improvement_rate * 10) * 100;
                        const y = (platformData.diversity + yearProgress * 0.1) * 10;
                        const r = (1 - genreData.male_bias) * 50;
                        
                        bubbleData.push({
                            x: Math.min(100, Math.max(0, x)),
                            y: Math.min(10, Math.max(0, y)),
                            r: Math.max(10, r),
                            label: `${platform.replace('_', ' ')} - ${genre}`,
                            platform,
                            genre
                        });
                        
                        colors.push({
                            bg: this.getColor(platform, genre, 0.7),
                            border: this.getColor(platform, genre, 1)
                        });
                    });
                });

                // Destroy existing chart
                if (this.charts.bubble) {
                    this.charts.bubble.destroy();
                }

                // Create new chart
                this.charts.bubble = new Chart(chartCtx, {
                    type: 'bubble',
                    data: {
                        datasets: [{
                            label: 'Representation Metrics',
                            data: bubbleData,
                            backgroundColor: colors.map(c => c.bg),
                            borderColor: colors.map(c => c.border),
                            borderWidth: 2,
                            hoverBorderWidth: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: {
                            duration: 800,
                            easing: 'easeInOutQuart'
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.9)',
                                callbacks: {
                                    title: (context) => {
                                        const d = context[0].raw;
                                        return `${d.platform.toUpperCase()} - ${d.genre.toUpperCase()}`;
                                    },
                                    label: (context) => {
                                        const d = context.raw;
                                        return [
                                            `Female Leads: ${d.x.toFixed(1)}%`,
                                            `Diversity: ${(d.y/10).toFixed(2)}`,
                                            `Equality: ${(d.r/50).toFixed(2)}`
                                        ];
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: { 
                                    display: true, 
                                    text: 'Female Lead Percentage (%)',
                                    color: getComputedStyle(document.body).getPropertyValue('--primary-text')
                                },
                                min: 0,
                                max: 100,
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            },
                            y: {
                                title: { 
                                    display: true, 
                                    text: 'Diversity Index (0-10)',
                                    color: getComputedStyle(document.body).getPropertyValue('--primary-text')
                                },
                                min: 0,
                                max: 10,
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            }
                        }
                    }
                });

                // Update color legend
                this.updateColorLegend();
            },

            updateColorLegend() {
                const legend = document.getElementById('colorLegend');
                if (!legend) return;

                legend.innerHTML = '';
                
                const platforms = this.state.platform === 'all' ? 
                    Object.keys(this.data.platforms) : [this.state.platform];
                    
                platforms.forEach(platform => {
                    const item = document.createElement('div');
                    item.className = 'color-item';
                    
                    const colorBox = document.createElement('div');
                    colorBox.className = 'color-box';
                    colorBox.style.background = this.getColor(platform, 'drama', 1);
                    
                    const label = document.createElement('span');
                    label.textContent = platform.replace('_', ' ').toUpperCase();
                    
                    item.appendChild(colorBox);
                    item.appendChild(label);
                    legend.appendChild(item);
                });
            },

            // ==================== NETWORK GRAPH ====================
            createNetworkGraph() {
                const container = document.getElementById('networkGraph');
                if (!container) return;

                container.innerHTML = '';
                
                const width = container.offsetWidth;
                const height = 600;
                
                // Generate nodes based on current filters
                const nodeCount = 40 + Math.round((this.state.year - 2015) * 3);
                const nodes = d3.range(nodeCount).map(i => ({
                    id: i,
                    gender: Math.random() < 0.45 ? 'male' : Math.random() < 0.9 ? 'female' : 'non-binary',
                    radius: 5 + Math.random() * 15
                }));
                
                // Generate links
                const links = [];
                for (let i = 0; i < nodeCount * 1.5; i++) {
                    links.push({
                        source: Math.floor(Math.random() * nodeCount),
                        target: Math.floor(Math.random() * nodeCount),
                        value: Math.random()
                    });
                }
                
                const svg = d3.select(container)
                    .append('svg')
                    .attr('width', width)
                    .attr('height', height);
                
                const simulation = d3.forceSimulation(nodes)
                    .force('link', d3.forceLink(links).id(d => d.id))
                    .force('charge', d3.forceManyBody().strength(-50))
                    .force('center', d3.forceCenter(width / 2, height / 2))
                    .force('collision', d3.forceCollide(d => d.radius + 2));
                
                const link = svg.append('g')
                    .selectAll('line')
                    .data(links)
                    .enter().append('line')
                    .attr('stroke', getComputedStyle(document.body).getPropertyValue('--primary-accent'))
                    .attr('stroke-opacity', 0.3)
                    .attr('stroke-width', d => Math.sqrt(d.value) * 2);
                
                const node = svg.append('g')
                    .selectAll('circle')
                    .data(nodes)
                    .enter().append('circle')
                    .attr('r', d => d.radius)
                    .attr('fill', d => {
                        const colors = {
                            'male': getComputedStyle(document.body).getPropertyValue('--primary-accent'),
                            'female': getComputedStyle(document.body).getPropertyValue('--primary-secondary'),
                            'non-binary': getComputedStyle(document.body).getPropertyValue('--primary-tertiary')
                        };
                        return colors[d.gender];
                    })
                    .call(d3.drag()
                        .on('start', dragstarted)
                        .on('drag', dragged)
                        .on('end', dragended));
                
                simulation.on('tick', () => {
                    link
                        .attr('x1', d => d.source.x)
                        .attr('y1', d => d.source.y)
                        .attr('x2', d => d.target.x)
                        .attr('y2', d => d.target.y);
                    
                    node
                        .attr('cx', d => Math.max(d.radius, Math.min(width - d.radius, d.x)))
                        .attr('cy', d => Math.max(d.radius, Math.min(height - d.radius, d.y)));
                });
                
                function dragstarted(event, d) {
                    if (!event.active) simulation.alphaTarget(0.3).restart();
                    d.fx = d.x;
                    d.fy = d.y;
                }
                
                function dragged(event, d) {
                    d.fx = event.x;
                    d.fy = event.y;
                }
                
                function dragended(event, d) {
                    if (!event.active) simulation.alphaTarget(0);
                    d.fx = null;
                    d.fy = null;
                }
            },

            // ==================== TIME SERIES ====================
            createTimeSeriesChart() {
                const container = document.getElementById('timeSeriesChart');
                if (!container) return;

                const years = [];
                for (let y = 2015; y <= this.state.year; y++) {
                    years.push(y);
                }
                
                const traces = [
                    {
                        x: years,
                        y: years.map(y => 0.35 + (y - 2015) * 0.032),
                        name: 'Gender Parity',
                        line: { color: '#00d4ff', width: 3 }
                    },
                    {
                        x: years,
                        y: years.map(y => 0.35 + (y - 2015) * 0.027),
                        name: 'Ethnic Diversity',
                        line: { color: '#ff006e', width: 3 }
                    },
                    {
                        x: years,
                        y: years.map(y => 0.42 - (y - 2015) * 0.004),
                        name: 'Age Representation',
                        line: { color: '#ffbe0b', width: 3 }
                    },
                    {
                        x: years,
                        y: years.map(y => 0.05 + (y - 2015) * 0.08),
                        name: 'LGBTQ+ Visibility',
                        line: { color: '#9d4edd', width: 3 }
                    }
                ];
                
                const layout = {
                    xaxis: { 
                        title: 'Year',
                        gridcolor: 'rgba(255,255,255,0.1)'
                    },
                    yaxis: { 
                        title: 'Representation Score',
                        gridcolor: 'rgba(255,255,255,0.1)'
                    },
                    paper_bgcolor: 'transparent',
                    plot_bgcolor: 'transparent',
                    font: { color: getComputedStyle(document.body).getPropertyValue('--primary-text') }
                };
                
                Plotly.newPlot('timeSeriesChart', traces, layout, {responsive: true});
            },

            // ==================== RADAR CHART ====================
            createRadarChart() {
                const ctx = document.getElementById('sentimentRadar');
                if (!ctx) return;

                const chartCtx = ctx.getContext('2d');
                
                if (this.charts.radar) {
                    this.charts.radar.destroy();
                }
                
                const yearModifier = (this.state.year - 2015) / 9;
                
                this.charts.radar = new Chart(chartCtx, {
                    type: 'radar',
                    data: {
                        labels: ['Protagonist', 'Antagonist', 'Support', 'Comic Relief', 'Romantic', 'Mentor'],
                        datasets: [
                            {
                                label: 'Male',
                                data: [85 - yearModifier * 10, 78, 62, 71, 45, 88],
                                borderColor: '#00d4ff',
                                backgroundColor: 'rgba(0, 212, 255, 0.2)'
                            },
                            {
                                label: 'Female',
                                data: [72 + yearModifier * 10, 45, 68, 52, 82, 61],
                                borderColor: '#ff006e',
                                backgroundColor: 'rgba(255, 0, 110, 0.2)'
                            },
                            {
                                label: 'Non-Binary',
                                data: [15 + yearModifier * 20, 10, 25, 18, 12, 8],
                                borderColor: '#ffbe0b',
                                backgroundColor: 'rgba(255, 190, 11, 0.2)'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100,
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            }
                        }
                    }
                });
            },

            // ==================== STATS UPDATE ====================
            updateStats() {
                const yearProgress = (this.state.year - 2015) / 9;
                
                // Calculate values based on year
                const diversity = (45 + yearProgress * 33.4).toFixed(1);
                const parity = (0.35 + yearProgress * 0.32).toFixed(2);
                const ethnic = (3.5 + yearProgress * 2.7).toFixed(1);
                const age = (4.2 - yearProgress * 0.4).toFixed(1);
                
                // Update DOM
                document.getElementById('diversityScore').textContent = diversity + '%';
                document.getElementById('genderParity').textContent = parity;
                document.getElementById('ethnicDiversity').textContent = ethnic;
                document.getElementById('ageScore').textContent = age;
                
                // Update changes
                document.getElementById('diversityChange').textContent = 
                    `↑ ${(yearProgress * 33.4).toFixed(1)}% from 2015`;
                document.getElementById('parityChange').textContent = 
                    `↑ ${(yearProgress * 0.32).toFixed(2)} from 2015`;
                document.getElementById('ethnicChange').textContent = 
                    `↑ ${(yearProgress * 2.7).toFixed(1)} from 2015`;
                document.getElementById('ageChange').textContent = 
                    `↓ ${(yearProgress * 0.4).toFixed(1)} from 2015`;
            },

            // ==================== INSIGHTS UPDATE ====================
            updateInsights() {
                const genre = this.state.genre === 'all' ? 'all' : this.state.genre;
                const genreData = this.data.genres[genre] || this.data.genres.drama;
                
                document.getElementById('centralBias').textContent = 
                    Math.round(genreData.male_bias * 100) + '%';
                document.getElementById('genreInsight').textContent = genre;
                
                document.getElementById('dialogueGap').textContent = 
                    Math.round(genreData.dialogue_gap * 100) + '%';
                document.getElementById('platformInsight').textContent = 
                    this.state.platform === 'all' ? 'all platforms' : this.state.platform.replace('_', ' ');
                
                document.getElementById('ageGap').textContent = 
                    Math.round(68 - (this.state.year - 2015) * 2) + '%';
                document.getElementById('yearInsight').textContent = this.state.year;
                
                document.getElementById('intersectionGap').textContent = 
                    Math.round(12 + (this.state.year - 2015) * 0.5) + '%';
            },

            // ==================== MASTER UPDATE ====================
            updateAllVisualizations() {
                // Show loading indicator
                const loader = document.getElementById('loadingIndicator');
                if (loader) loader.classList.add('active');
                
                // Update all components
                requestAnimationFrame(() => {
                    this.createBubbleChart();
                    this.createNetworkGraph();
                    this.createTimeSeriesChart();
                    this.createRadarChart();
                    this.updateStats();
                    this.updateInsights();
                    
                    // Hide loading indicator
                    setTimeout(() => {
                        if (loader) loader.classList.remove('active');
                    }, 300);
                });
            }
        };

        // ==================== THEME MANAGEMENT ====================
        function setTheme(theme, button) {
            document.body.className = theme === 'purple' ? 'purple-theme' : 
                                     theme === 'pastel' ? 'pastel-theme' : '';
            
            // Update active button
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            if (button) button.classList.add('active');
            
            StreamLensApp.state.theme = theme;
            StreamLensApp.updateAllVisualizations();
        }

        // ==================== INITIALIZE ON LOAD ====================
        window.addEventListener('DOMContentLoaded', () => {
            StreamLensApp.init();
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            StreamLensApp.createNetworkGraph();
        });
    </script>
</body>
</html>